<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mobile Python Pong</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { background: #000; margin: 0; color: white; text-align: center; overflow: hidden; }
        canvas { display: block; background: #111; touch-action: none; }
    </style>
</head>
<body>
    <canvas id="pongCanvas"></canvas>
    <script type="py">
import asyncio
from js import document, window

canvas = document.getElementById("pongCanvas")
canvas.width = window.innerWidth
canvas.height = window.innerHeight
ctx = canvas.getContext("2d")

ball = {"x": canvas.width/2, "y": canvas.height/2, "dx": 5, "dy": 5}
p_l = {"y": canvas.height/2 - 40}
p_r = {"y": canvas.height/2 - 40}

def handle_touch(e):
    e.preventDefault()
    for t in e.touches:
        if t.pageX < canvas.width / 2: p_l["y"] = t.pageY - 40
        else: p_r["y"] = t.pageY - 40

document.addEventListener("touchstart", handle_touch, False)
document.addEventListener("touchmove", handle_touch, False)

async def main():
    while True:
        ball["x"] += ball["dx"]; ball["y"] += ball["dy"]
        if ball["y"] <= 0 or ball["y"] >= canvas.height: ball["dy"] *= -1
        if (ball["x"] < 20 and p_l["y"] < ball["y"] < p_l["y"]+80) or \
           (ball["x"] > canvas.width-20 and p_r["y"] < ball["y"] < p_r["y"]+80):
            ball["dx"] *= -1
        if ball["x"] < 0 or ball["x"] > canvas.width:
            ball["x"], ball["y"] = canvas.width/2, canvas.height/2
        
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        ctx.fillStyle = "white"
        ctx.fillRect(10, p_l["y"], 10, 80)
        ctx.fillRect(canvas.width-20, p_r["y"], 10, 80)
        ctx.beginPath(); ctx.arc(ball["x"], ball["y"], 8, 0, 6.28); ctx.fill()
        await asyncio.sleep(0.016)

asyncio.ensure_future(main())
    </script>
</body>
</html>
